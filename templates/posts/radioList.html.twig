{% extends 'base.html.twig' %}

{% block body %}
    <div>
    <small class="text-secondary">Radio stations | List</small>
    <div class="text-right mt-3">
    <h5>Filter</h5>
    {{ form_start(form) }}
    <div class="my-custom-class-for-errors">
        {{ form_errors(form) }}
    </div>

    <div class="row">
        <div class="col">
            {{ form_row(form.country) }}
        </div>
        <div class="col" id="some-custom-id">
            {{ form_row(form.style) }}
        </div>
        <div class="col" id="some-custom-id">
            {{ form_row(form.top) }}
        </div>
    </div>
{{ form_end(form) }}
    <div class="mb-5">
    <a class="btn btn-primary" onClick="filter()"><i class="fa-solid fa-magnifying-glass"></i> Filter</a>
    <a class="btn btn-primary" onClick="resetFilter()"><i class="fa fa-times"></i> Reset</a>
    </div>
    <small>Total count: {{totalCount}}</small>
    <hr>
    <div class="d-flex justify-content-end">
    <a class="btn btn-primary" href="{{ path('radio_add') }}"><i class="fa-solid fa-plus"></i> Add new</a>
    </div>
    </div>
        <div class="mt-4">
            <div class="table-responsive">
            <table class="table table-sm">
            <thead>
                <tr>
                <th class="text-center" scope="col">ID</th>
                <th scope="col"></th>
                <th scope="col">Name</th>
                <th class="text-center" scope="col">Country</th>
                <th class="text-center"  scope="col">Style</th>
                <th class="text-center" scope="col">Top</th>
                <th class="text-center" scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% if (posts is defined and posts is not empty) %}
                    {% for item in posts %}
                    <tr>
                        <td class="align-middle text-center">{{ item.id }}</td>
                        <td class="align-middle text-center"><img src="{{ item.img}}" alt="radio"></td>
                        <td class="align-middle">{{ item.title }}</td>
                        <td class="align-middle text-center">{{ item.country }}</td>
                        {% if item.style is not empty %}
                        <td class="align-middle text-center">{{ item.style}}</td>
                        {% else %}
                        <td class="align-middle text-center">-</td>
                        {% endif %}
                        {% if item.top == 1 %}
                        <td class="align-middle text-center"><i class="fa-solid fa-check green"></i></td>
                        {% else %}
                        <td class="align-middle text-center"><i class="fa-solid fa-xmark red"></i></td>
                        {% endif %}
                        {# <td class="align-middle"><a href="{{ path('radio_delete', {id: item.id}) }}"><i class="fa-solid fa-trash-can"></i> Delete</a></td> #}
                        <td class="align-middle text-center"><a href="{{ path('radio_edit', {id: item.id}) }}"><i class="fa-solid fa-pen-to-square"></i> Edit</a></td>
                    </tr>
                    {% endfor %}
                {% endif %}
            
            </tbody>
            </table>
            </div>
            <div class="navigation d-flex justify-content-center mt-5">
                {{ knp_pagination_render(posts, '@KnpPaginator/Pagination/twitter_bootstrap_v4_pagination.html.twig') }}
            </div>
            </div>
        </div>
    </div>
    <script>
    document.addEventListener("DOMContentLoaded", function(){
        let params = new URLSearchParams(document.location.search);
        let country = params.get("country");
        let style = params.get("style");
        let top = params.get("top");
        let title = params.get("title");
        if (country) {
            document.getElementById('radio_filter_form_country').value = country;
        }
        if (style) {
            document.getElementById('radio_filter_form_style').value = style;
        }
        if (top) {
            document.getElementById('radio_filter_form_top').value = top;
        }
        if (title) {
            document.getElementById('radio_filter_form_searchByTitle').value = title;
        }
    });

    function filter() {
        var url = new URL(window.location.href);
        var params = new URLSearchParams(url.search);
        params.delete('country');
        params.delete('style');
        params.delete('top');
        params.delete('page');
        params.delete('title');
        var country = document.getElementById('radio_filter_form_country').value;
        var style = document.getElementById('radio_filter_form_style').value;
        var top = document.getElementById('radio_filter_form_top').value;
        var title = document.getElementById('radio_filter_form_searchByTitle').value;
        params.set('country', country);
        params.set('style', style);
        params.set('top', top);
        params.set('title', title);
        console.log(params.toString());
        window.location  = '?' + params;
    }

    function resetFilter() {
        document.getElementById('radio_filter_form_country').value = null;
        document.getElementById('radio_filter_form_style').value = null;
        document.getElementById('radio_filter_form_top').value = null;
        document.getElementById('radio_filter_form_searchByTitle').value = null;
    }
    </script>
{% endblock %}
